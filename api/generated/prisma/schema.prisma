generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://neondb_owner:npg_QcbX3sOYTSE7@ep-lucky-feather-ahod72tf-pooler.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require"
}

model Role {
  id        Int       @id @default(autoincrement())
  name      String
  updatedAt DateTime  @updatedAt
  createdAt DateTime  @default(now())
  deletedAt DateTime?

  user User[]
}

model User {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  password  String
  firstName String?
  lastName  String?
  roleId    Int       @default(1) // Default role is 1 (admin)
  status    String    @default("active") //['pending', 'active', 'inactive', 'banned', 'deleted', 'review', 'suspended' ]
  updatedAt DateTime  @updatedAt
  createdAt DateTime  @default(now())
  deletedAt DateTime?

  media   Media[]
  meta    UserMeta[]
  vehicle Vehicle[]
  role    Role       @relation(fields: [roleId], references: [id])
}

model UserMeta {
  meta_id    Int      @id @default(autoincrement())
  id         Int
  meta_key   String
  meta_value String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user User @relation(fields: [id], references: [id])
}

model Vehicle {
  id           Int       @id @default(autoincrement())
  name         String
  description  String?
  regularPrice Float     @default(0)
  salePrice    Float     @default(0)
  isFeatured   Boolean   @default(false)
  userId       Int
  parentId     Int       @default(0)
  status       String    @default("draft")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  deletedAt    DateTime?

  meta       VehicleMeta[]
  categories VehicleCategory[] // Many-to-many relation

  user User @relation(fields: [userId], references: [id])
}

model VehicleMeta {
  meta_id    Int      @id @default(autoincrement())
  id         Int
  meta_key   String
  meta_value String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  vehicle Vehicle @relation(fields: [id], references: [id])
}

enum CategoryType {
  brand
  tag
}

model Category {
  id               Int          @id @default(autoincrement())
  name             String
  type             CategoryType
  imageId          Int?
  description      String?
  shortDescription String?
  parentId         Int?

  parent   Category?         @relation("CategoryParent", fields: [parentId], references: [id])
  children Category[]        @relation("CategoryParent")
  vehicles VehicleCategory[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  image Media? @relation(fields: [imageId], references: [id])
}

model VehicleCategory {
  vehicleId  Int
  categoryId Int

  vehicle  Vehicle  @relation(fields: [vehicleId], references: [id])
  category Category @relation(fields: [categoryId], references: [id])

  @@id([vehicleId, categoryId])
}

model Media {
  id           Int       @id @default(autoincrement())
  name         String
  mimeType     String
  caption      String?
  altText      String?
  width        Int?
  height       Int?
  size         Int? // File size in bytes
  url          String? // File storage location (local or remote)
  thumbnailUrl String? // Optional thumbnail image
  userId       Int
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  deletedAt    DateTime?

  user     User       @relation(fields: [userId], references: [id])
  category Category[]
}

model Log {
  id          Int      @id @default(autoincrement())
  action      String // e.g. 'DELETE', 'CREATE', 'UPDATE'
  entity      String // e.g. 'User', 'UserMeta'
  entityId    Int // ID of the affected entity
  performedBy Int // ID of the user who triggered the action
  note        String // notes about what was changed
  detail      String? // Optional JSON 
  createdAt   DateTime @default(now())
}
